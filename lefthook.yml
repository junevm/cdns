# ==============================================================================
# Lefthook Configuration
# ==============================================================================

pre-commit:
  parallel: true
  commands:
    format-go:
      glob: "**/*.go"
      run: |
        gofmt -w {staged_files}
        git add {staged_files}
      stage_fixed: true

    lint-go-fast:
      glob: "**/*.go"
      run: go vet ./...

    tidy-go-mod:
      glob: "{go.mod,go.sum}"
      run: go mod tidy && git add go.mod go.sum

    check-secrets-basic:
      run: |
        if git diff --cached | grep -iE '(api_key|secret_key|password|token)["\s]*[:=]["\s]*[a-zA-Z0-9]{8,}'; then
          echo "Error: Potential secret detected in staged changes"
          exit 1
        fi

commit-msg:
  commands:
    validate-conventional-commits:
      run: cog verify --file {1}

pre-push:
  commands:
    test-go:
      glob: "**/*.go"
      run: go test ./...

    build-go:
      glob: "**/*.go"
      run: go build -o /dev/null .

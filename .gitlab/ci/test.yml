test:cli:
  stage: test
  image: golang:1.25
  before_script:
    - mkdir -p .bin
    - curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b .bin v1.63.4
  script:
    - export PATH=$PATH:$PWD/.bin
    - cd apps/cli
    - go mod tidy
    - go test -v -race -coverprofile=coverage.txt -covermode=atomic ./...
    - golangci-lint run ./...
  coverage: '/coverage: \d+.\d+% of statements/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: apps/cli/coverage.txt

test:docs:
  stage: test
  image: node:20-alpine
  script:
    - cd apps/documentation
    - npm install -g pnpm
    - pnpm install --frozen-lockfile
    # Check for dead links, build errors, etc.
    - pnpm build

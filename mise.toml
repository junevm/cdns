[tools]
golangci-lint = { version = "latest" }
lefthook = "latest"
go = "latest"
cocogitto = "latest"
goreleaser = "latest"


[hooks]
postinstall = ['mise lock', 'lefthook install']


[env]
DO_NOT_TRACK = "1"

[settings]
experimental = true
quiet = false
lockfile = true

[tasks.clean]
description = "Cleanup the project and bring it to fresh state"
run = '''
mise cli:clean
mise docs:clean
mise prune
# Remove all installed mise tools
for tool in $(mise ls --installed | awk '{print $1}' | grep -v '^$'); do
  if [ -n "$tool" ] && [ "$tool" != "Tool" ]; then
    mise uninstall "$tool" 2>/dev/null || true
  fi
done
git clean -fdX # Remove everything ignored by git
echo "Project cleaned."
'''


[tasks.setup]
description = "Set up the development environment"
run = ["mise install", "mise tidy"]

[tasks.setup_tasks]
description = "Setup tasks for simplicity"
depends_on = ["setup"]

[tasks.tidy]
description = "Tidy Go modules"
run = "go mod tidy"

[tasks.dev]
description = "Run the CLI in development mode"
run = ["go run ./main.go"]

[tasks.test]
description = "Run all tests for the CLI"
run = "go test -v -race -coverprofile=coverage.out ./..."

[tasks.lint]
description = "Run linters on the CLI codebase"
run = ["go vet ./... && go fmt ./...", "golangci-lint run"]

[tasks.clean]
description = "Cleanup the project and bring it to fresh state"
run = '''
# Remove all installed mise tools
for tool in $(mise ls --installed | awk '{print $1}' | grep -v '^$'); do
  if [ -n "$tool" ] && [ "$tool" != "Tool" ]; then
    mise uninstall "$tool" 2>/dev/null || true
  fi
done
git clean -fdX # Remove everything ignored by git
echo "Project cleaned."
'''


[tasks."release:snapshot"]
description = "Build a snapshot release without publishing (for testing)"
run = "goreleaser release --snapshot --clean --skip=publish"

[tasks."release:check"]
description = "Validate the GoReleaser configuration"
run = "goreleaser check"
